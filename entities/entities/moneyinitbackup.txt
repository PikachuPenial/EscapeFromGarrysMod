AddCSLuaFile("cl_init.lua")
AddCSLuaFile("shared.lua")

include("shared.lua")

ENT.Value = 0
ENT.SpawnChance = 0

function ENT:KeyValue(key, value)
   if key == "money_value" then
		self.Value = tonumber(value)
   end
   
   if key == "spawn_chance" then
      self.SpawnChance = tonumber(value)
   end
end

function ENT:Initialize()

	local spawnChance = math.random(1, 100)
		
	if spawnChance <= self.SpawnChance then

		self:SetModel(self.Model)
		self:PhysicsInit(SOLID_VPHYSICS)
		self:SetMoveType(MOVETYPE_VPHYSICS)
		self:SetSolid(SOLID_VPHYSICS)
		
		self:SetUseType(SIMPLE_USE)
		
		local phys = self:GetPhysicsObject()
		
		if (IsValid(phys)) then
		
			self:SetValue(self.Value)
			
			phys:Wake()
			
		end
	end
end

function ENT:SpawnFunction(ply, tr, ClassName)
    if (!tr.Hit) then return end

    tr.start = ply:EyePos()
    tr.endpos = ply:EyePos() + 95 * ply:GetAimVector()
    tr.filter = ply

    local trace = util.TraceLine(tr)

    local ent = ents.Create(ClassName)

    ent:SetValue(1000)

    ent:SetPos(trace.HitPos)
    ent:Spawn()
    ent:Activate()

    return ent
end

function ENT:Use(activator, caller)
	activator:SetNWInt("playerMoney", activator:GetNWInt("playerMoney") + self:GetValue())
	
	self:Remove()
end